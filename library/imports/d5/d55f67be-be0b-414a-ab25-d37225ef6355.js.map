{"version":3,"sources":["../../../../assets/Script/assets/Script/Lead.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../assets/Script","sourcesContent":["const {ccclass, property} = cc._decorator;\n\n// 角色动画状态机\nenum ROLESTATE {\n    WALK = 'walk_right',\n    JUMP = 'jump',\n    STAND = 'stand',\n    SHAKE = 'shake',\n    DROP = 'drop'\n}\n\n@ccclass\nexport default class Lead extends cc.Component {\n    \n    @property(cc.Node)\n    lead: cc.Node = null;\n\n    @property\n    jumpStep: number = null;\n\n    private gameInstant: cc.Component = null;\n    // 皮肤管理\n    // TODO\n    private skin: cc.SpriteFrame = null;\n    \n    // 动画状态管理\n    // TODO\n    private currState: ROLESTATE = null;\n    private anim: cc.Animation = null;\n\n    // 游戏画板动作管理\n    private touchpad: cc.Node = null;\n\n    // 着陆块\n    private land: cc.BoxCollider = null;\n    \n    // 代替 onLoad 方法\n    init(touchpad: cc.Node, game: cc.Component) {\n        this.gameInstant = game;\n        this.anim = this.lead.getComponent(cc.Animation);\n        this.touchpad = touchpad;\n        this.touchpad.on(cc.Node.EventType.TOUCH_START, () => {this.act(ROLESTATE.JUMP)}, this);\n        this.act(ROLESTATE.WALK);\n    }\n\n    start() {\n        this.loadSkin('');\n    }\n\n    onDestroy() {\n        this.touchpad.off(cc.Node.EventType.TOUCH_START, () => {this.act(ROLESTATE.JUMP)}, this);\n    }\n\n    loadSkin(skin: string) {\n        // load the skin configs\n    }\n\n    act(state: ROLESTATE) {\n        switch(state) {\n            case this.currState:\n                // 重复表演当前状态时，不执行任何动画\n                break;\n            case ROLESTATE.WALK:\n                this.currState = ROLESTATE.WALK;\n                this.anim.play(ROLESTATE.WALK);\n                break;\n            case ROLESTATE.JUMP:\n                if(this.currState === ROLESTATE.DROP){\n                    break;\n                }else {\n                    this.currState = ROLESTATE.JUMP;\n                    this.anim.play(ROLESTATE.JUMP);\n                    this.lead.runAction(cc.sequence(\n                        cc.jumpTo(.6, cc.v2(this.lead.x, this.lead.y + 100), 150, 1),\n                        cc.moveTo(.1, cc.v2(this.lead.x, this.lead.y)),\n                        cc.callFunc(() => {\n                            this.act(ROLESTATE.DROP)\n                        }, this)\n                    ));\n                    break;\n                }\n            case ROLESTATE.SHAKE:\n                break;\n            case ROLESTATE.DROP:\n                this.currState = ROLESTATE.DROP;\n                // TODO 新的动画\n                // this.anim.play(ROLESTATE.DROP)\n                this.anim.stop();\n                // TODO 跑步继续，跳跃的话播放最后一针\n                this.lead.runAction(\n                    cc.moveBy(.7, cc.v2(0, -500))\n                )\n                break;\n            case ROLESTATE.STAND:\n                break;\n        }\n    }\n\n    update() {\n        if (this.land){\n            if (this.currState != ROLESTATE.JUMP){\n                if(this.land.world.aabb.xMax < \n                    this.lead.convertToWorldSpaceAR(cc.Vec2.ZERO).x) {\n                    this.act(ROLESTATE.DROP);\n                }\n            }\n        } \n    }\n\n    onCollisionEnter (other: cc.BoxCollider, self: cc.BoxCollider) {\n        this.land = other;\n        if(other.world.aabb.yMax > self.world.aabb.yMin + 20) {\n            this.gameInstant.end();\n        }else {\n            this.lead.stopAllActions();\n            this.act(ROLESTATE.WALK);\n            this.lead.y += other.world.aabb.yMax - self.world.aabb.yMin;\n            this.gameInstant.getScore();\n        }\n    }\n\n}\n"]}